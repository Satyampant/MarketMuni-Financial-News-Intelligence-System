# MarketMuni Configuration - Financial News Intelligence System

# ----------------------------------------------------------------------------
# DEDUPLICATION
# ----------------------------------------------------------------------------
deduplication:
  bi_encoder_threshold: 0.50     # Lower = higher recall (more candidates)
  cross_encoder_threshold: 0.70  # Higher = stricter precision (recommended >= 0.70)
  
  bi_encoder_model: "all-mpnet-base-v2"
  cross_encoder_model: "cross-encoder/stsb-distilroberta-base"

# ----------------------------------------------------------------------------
# ENTITY EXTRACTION
# ----------------------------------------------------------------------------
entity_extraction:
  spacy_model: "en_core_web_sm"  # Options: en_core_web_sm, en_core_web_lg, en_core_web_trf
  use_spacy: true
  
  event_keywords:
    - "dividend"
    - "buyback"
    - "stock buyback"
    - "merger"
    - "acquisition"
    - "ipo"
    - "rates"
    - "repo rate"
    - "interest rate"
    - "policy rate"
    - "profit"
    - "loss"
    - "revenue"
    - "earnings"
    - "quarterly results"
    - "rights issue"
    - "delisting"
    - "bonus"
    - "split"
    - "consolidation"
    - "restructuring"
    - "capex"
    - "guidance"
    - "outlook"
    - "forecast"
    - "default"
    - "downgrade"
    - "upgrade"
    - "rating"
    - "credit rating"
    - "stake sale"
    - "divestment"
    - "spin-off"
    - "demerger"
    - "capacity addition"
    - "plant closure"
    - "debt restructuring"
    - "working capital"
    - "cash flow"
    - "free cash flow"

# ----------------------------------------------------------------------------
# SENTIMENT ANALYSIS
# ----------------------------------------------------------------------------
sentiment_analysis:
  method: "hybrid"  # Options: rule_based, finbert, hybrid
  
  hybrid_weights:   # Active only when method="hybrid"
    finbert_weight: 0.4
    rule_weight: 0.6
  
  finbert:
    model_name: "ProsusAI/finbert"
    # Alternative: "mrm8488/distilroberta-finetuned-financial-news-sentiment-analysis"
    device: null  # null for auto-detect, or "cuda"/"cpu"
  
  rule_based:
    spacy_model: "en_core_web_sm"
    use_spacy: true
  
  entity_weights:
    company: 1.3
    sector: 1.1
    regulator: 1.2
  
  event_modifiers:  # Sentiment score multipliers
    dividend: 1.3
    buyback: 1.3
    stock_buyback: 1.3
    merger: 1.1
    acquisition: 1.1
    ipo: 1.2
    earnings: 1.2
    profit: 1.2
    loss: 1.2
    layoff: 1.4
    bankruptcy: 1.5
    repo_rate: 1.3
    interest_rate: 1.3
    rates: 1.2
    policy_rate: 1.3
    quarterly_results: 1.2
    revenue: 1.1
    rights_issue: 1.2
    delisting: 1.4
    share_buyback: 1.3
    bonus_issue: 1.2
    split: 1.1
    consolidation: 1.1
    restructuring: 1.2
    divestment: 1.1
    capital_raising: 1.2

# ----------------------------------------------------------------------------
# VECTOR STORE
# ----------------------------------------------------------------------------
vector_store:
  collection_name: "financial_news"
  persist_directory: "data/chroma_db"
  embedding_model: "all-mpnet-base-v2"
  distance_metric: "cosine"  # Options: cosine, l2, ip

# ----------------------------------------------------------------------------
# QUERY PROCESSING
# ----------------------------------------------------------------------------
query_processing:
  default_top_k: 10
  min_similarity: 0.3  # 0-1 scale
  
  multi_query:
    max_context_queries: 3
    initial_retrieval_multiplier: 2  # Increases candidate pool size
  
  reranking_weights:
    direct_mention:
      strategy_weight: 0.7
      semantic_weight: 0.3
    regulator_filter:
      strategy_weight: 0.8
      semantic_weight: 0.2
    sector_wide:
      strategy_weight: 0.5
      semantic_weight: 0.5
    semantic_theme:
      strategy_weight: 0.5
      semantic_weight: 0.5
  
  sentiment_boost:
    enabled: true
    max_multiplier: 1.5

# ----------------------------------------------------------------------------
# STOCK IMPACT & SUPPLY CHAIN
# ----------------------------------------------------------------------------
stock_impact:
  confidence_thresholds:
    direct: 0.80
    sector: 0.70
    regulatory: 0.50
  fuzzy_match_threshold: 0.80

supply_chain:
  traversal_depth: 1      # 1 = direct partners only, 2 = include indirect
  min_impact_score: 25.0
  weight_decay: 0.8       # Decay factor for multi-hop relationships

# ----------------------------------------------------------------------------
# API & INFRASTRUCTURE
# ----------------------------------------------------------------------------
api:
  host: "0.0.0.0"
  port: 8000
  reload: true
  title: "Financial News Intelligence API"
  description: "Multi-agent AI system for processing and querying financial news with sentiment analysis"
  version: "1.0.0"
  
  rate_limit:
    enabled: false
    requests_per_minute: 60

resources:  # Relative to app/resources/
  company_aliases: "company_aliases.json"
  sector_tickers: "sector_tickers.json"
  regulators: "regulators.json"
  regulator_impact: "regulator_sector_impact.json"
  supply_chain_graph: "supply_chain_graph.json"

logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file_logging:
    enabled: false
    path: "logs/marketmuni.log"
    max_bytes: 10485760
    backup_count: 5

performance:
  cache_embeddings: true
  batch_size: 32
  num_workers: 4

development:
  debug: false
  use_mock_data: false
  mock_data_path: "mock_news_data.json"
  enable_profiling: false





# ----------------------------------------------------------------------------
# LLM CONFIGURATION
# ----------------------------------------------------------------------------
llm:
  provider: "groq"
  model: "llama-3.3-70b-versatile"  # Options: llama-3.3-70b-versatile, llama-3.1-8b-instant, mixtral-8x7b-32768
  temperature: 0.1                   # Lower = more deterministic (0.0-1.0)
  max_tokens: 4096                   # Maximum response length
  timeout: 30                        # Request timeout in seconds
  max_retries: 3                     # Retry attempts on failure
  
  # Alternative models for specific tasks
  models:
    fast: "llama-3.1-8b-instant"        # For quick entity extraction
    reasoning: "llama-3.3-70b-versatile" # For complex analysis
    structured: "llama-3.3-70b-versatile" # For JSON output
  
  # Feature flags for gradual migration
  features:
    entity_extraction: true          # Use LLM for entity extraction
    stock_mapping: true              # Use LLM for stock impact mapping
    sentiment_analysis: true         # Use LLM for sentiment
    supply_chain: true               # Use LLM for cross-impact analysis
    query_expansion: true            # Use LLM for query understanding